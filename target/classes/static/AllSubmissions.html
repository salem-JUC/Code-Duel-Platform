<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./Style/styleSP.css">
    <link rel="stylesheet" href="./Style/stylepp.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submissions Table</title>
</head>
<body>
    
<h1>Submissions Table</h1>

<table>
    <thead>
        <tr>
            <th>Username</th>
            <th>Submission ID</th>
            <th>Challenge Title</th>
            <th>Difficulty</th>
            <th>Programming Language</th>
            <th>Result</th>
        </tr>
    </thead>
    <tbody id="table-body">
        
        <!-- Rows will be populated here by JavaScript -->

    </tbody>
</table>
<button class="submissions-toggle-btn"  onclick="window.location.href='submissionDetails.html'">BACK</button>

</body>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    challengeId = urlParams.get('challengeId');

    async function fetchDetails() {
        try {
            const response = await fetch(`/api/submissions/challenge/${challengeId}`, {
                credentials: 'include'
            });

            if(!response.ok){
                throw new Error("Failed to Fetch user's submissions");
            }

            return response.json();
        } catch (error) {
            console.error('Error fetching submissions:', error);
            return null;
        }
    }

    async function displaySubmissions(){
        const submissions = await fetchDetails();
        console.log(submissions)
        tbody = document.getElementById("table-body")
        for await (const submission of submissions) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <tr>
                    <td data-label="Username">${submission.username}</td>
                    <td data-label="Submission ID"><a href="submissionDetails.html?id=${submission.submissionId}">${submission.submissionId}</a></td>
                    <td data-label="Challenge Title">${submission.challengeTitle}</td>
                    <td data-label="Difficulty">${submission.difficulty}</td>
                    <td data-label="Programming Language">${submission.programmingLanguage}</td>
                    <td data-label="Result" class="result-pass">${submission.result}</td>
                </tr>
            `
                
            tbody.appendChild(row);
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        displaySubmissions();
    });
</script>
</html>
